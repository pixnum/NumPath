<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Numerology Calculator</title>
  <style>
    body { font-family: sans-serif; background: #111; color: #eee; margin: 0; padding: 2rem; }
    h1, h2, h3 { color: #ffcc00; }
    input, select, button, textarea { margin: 0.5rem 0; padding: 0.5rem; width: 100%; max-width: 600px; }
    .grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; max-width: 300px; margin-top: 1rem; }
    .grid div { background: #222; padding: 1rem; text-align: center; border: 1px solid #555; font-size: 1.2rem; }
    textarea { height: 200px; }
  </style>
</head>
<body>
  <h1>Offline Numerology Calculator</h1>

  <label for="fullname">Full Name:</label>
  <input type="text" id="fullname" placeholder="Enter your full name">

  <label for="dob">Date of Birth:</label>
  <input type="date" id="dob">

  <label for="system">Numerology System:</label>
  <select id="system">
    <option value="pythagorean">Pythagorean</option>
    <option value="chaldean">Chaldean</option>
  </select>

  <label for="partner">Compare Name (optional):</label>
  <input type="text" id="partner" placeholder="Enter second name to check compatibility">

  <button onclick="calculateAll()">Calculate</button>

  <h2>Numerology Report</h2>
  <textarea id="report" readonly></textarea>

  <h3>Lo Shu Grid</h3>
  <div class="grid" id="loShuGrid"></div>

  <script>
    const CHALDEAN = { A:1,B:2,C:3,D:4,E:5,F:8,G:3,H:5,I:1,J:1,K:2,L:3,M:4,N:5,O:7,P:8,Q:1,R:2,S:3,T:4,U:6,V:6,W:6,X:5,Y:1,Z:7 };
    const PYTHAGOREAN = { A:1,B:2,C:3,D:4,E:5,F:6,G:7,H:8,I:9,J:1,K:2,L:3,M:4,N:5,O:6,P:7,Q:8,R:9,S:1,T:2,U:3,V:4,W:5,X:6,Y:7,Z:8 };
    const VOWELS = ['A','E','I','O','U'];
    const MASTER_NUMS = [11, 22, 33];
    const KARMIC_DEBT = [13, 14, 16, 19];

    function reduceNumber(num) {
      while (num > 9 && !MASTER_NUMS.includes(num)) {
        num = num.toString().split('').reduce((a,b)=>a+parseInt(b),0);
      }
      return num;
    }

    function letterToNum(letter, system) {
      letter = letter.toUpperCase();
      if (system === 'chaldean') return CHALDEAN[letter] || 0;
      return PYTHAGOREAN[letter] || 0;
    }

    function calcNameValues(name, system) {
      name = name.toUpperCase().replace(/[^A-Z]/g, '');
      const nums = name.split('').map(l => letterToNum(l, system));
      const vowels = name.split('').filter(l => VOWELS.includes(l)).map(l => letterToNum(l, system));
      const consonants = name.split('').filter(l => !VOWELS.includes(l)).map(l => letterToNum(l, system));
      return {
        expression: nums.reduce((a,b)=>a+b,0),
        soulUrge: vowels.reduce((a,b)=>a+b,0),
        personality: consonants.reduce((a,b)=>a+b,0),
        full: name,
        heatmap: name.split('').map(l => `${l}:${letterToNum(l, system)}`).join(', ')
      }
    }

    function calcDOBValues(dob) {
      const [y,m,d] = dob.split('-').map(n=>parseInt(n));
      const lifePath = reduceNumber(y)+reduceNumber(m)+reduceNumber(d);
      return {
        day: d,
        month: m,
        year: y,
        lifePath: reduceNumber(lifePath),
        rawLP: lifePath,
        birthday: d,
        attitude: reduceNumber(d+m),
        personalYear: reduceNumber(y + new Date().getFullYear())
      }
    }

    function calcLoShu(dob) {
      const digits = dob.replace(/-/g, '').split('').map(Number);
      let grid = {};
      for (let i=1;i<=9;i++) grid[i]=0;
      digits.forEach(d=>{ if (d !== 0) grid[d]++; });
      return grid;
    }

    function showLoShu(grid) {
      const container = document.getElementById('loShuGrid');
      container.innerHTML = '';
      for (let i=1; i<=9; i++) {
        container.innerHTML += `<div>${i}<br>${grid[i]}</div>`;
      }
    }

    function calculateAll() {
      const name = document.getElementById('fullname').value.trim();
      const dob = document.getElementById('dob').value;
      const system = document.getElementById('system').value;
      const partner = document.getElementById('partner').value.trim();
      if (!name) return alert("Please enter your name");

      const nv = calcNameValues(name, system);
      let dobVals = {day:'', month:'', year:'', lifePath:'', birthday:'', attitude:'', personalYear:'', rawLP:''};
      let loShu = {};
      if (dob) {
        dobVals = calcDOBValues(dob);
        loShu = calcLoShu(dob);
        showLoShu(loShu);
      }

      const maturity = reduceNumber(nv.expression + dobVals.lifePath);
      const compoundExpression = nv.expression;
      const reducedExpression = reduceNumber(nv.expression);

      const report = [];
      report.push(`Full Name: ${nv.full}`);
      report.push(`Numerology System: ${system}`);
      report.push(`Expression Number: ${compoundExpression} → ${reducedExpression}`);
      report.push(`Soul Urge Number: ${nv.soulUrge} → ${reduceNumber(nv.soulUrge)}`);
      report.push(`Personality Number: ${nv.personality} → ${reduceNumber(nv.personality)}`);
      report.push(`Vowel-Consonant Breakdown: ${nv.heatmap}`);

      if (dob) {
        report.push(`Life Path Number: ${dobVals.rawLP} → ${dobVals.lifePath}`);
        report.push(`Birthday Number: ${dobVals.birthday}`);
        report.push(`Attitude Number: ${dobVals.attitude}`);
        report.push(`Personal Year Number: ${dobVals.personalYear}`);
        report.push(`Maturity Number: ${nv.expression + dobVals.lifePath} → ${maturity}`);
        report.push(`Lo Shu Grid: ${JSON.stringify(loShu)}`);
        const missing = Object.entries(loShu).filter(([k,v])=>v===0).map(([k])=>k);
        report.push(`Missing Numbers: ${missing.join(', ')}`);
        const repeating = Object.entries(loShu).filter(([k,v])=>v>1).map(([k,v])=>`${k}(${v})`);
        report.push(`Repeating Numbers: ${repeating.join(', ')}`);
      }

      if (MASTER_NUMS.includes(reducedExpression)) report.push(`Master Number Detected: ${reducedExpression}`);
      if (KARMIC_DEBT.includes(compoundExpression)) report.push(`⚠️ Karmic Debt Number Found: ${compoundExpression}`);

      if (partner) {
        const partnerVal = calcNameValues(partner, system);
        const comp = reduceNumber(partnerVal.expression + nv.expression);
        report.push(`Name Compatibility with '${partner}': Total = ${partnerVal.expression + nv.expression} → ${comp}`);
      }

      report.push(`\nPersonalized Report Interpretation (each section 100 words)...`);
      report.push(`(Not shown here for brevity. Add predefined 100-word meanings per number in code or local JSON)`);

      document.getElementById('report').value = report.join("\n");
    }
  </script>
</body>
</html>
