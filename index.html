<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1" />
  <title>Numeroscope — Ultimate Numerology Calculator</title>
  <meta name="description" content="Numeroscope: Pythagorean & Chaldean numerology with detailed 100-word reports. PWA-ready, offline-first, responsive UI." />
  <meta name="theme-color" content="#5b3e96" />

  <!-- Fallback favicons (embedded) -->
  <link rel="icon" type="image/png" sizes="32x32" href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAAAXVBMVEUAAAD///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////9gUkQXAAAAGnRSTlMA6LnhXwoOayvf90nb4SvBzE0IlP52S+YQkpRkAAABeSURBVHjaY2AgBooYmJhIpKhoaGiGgYGBkYmRiqAqqqqurq6uDh4eHi4eLj4+Ph4+Ph4eHg4ODi4uLg4ODi4uLg4ODi4uLg4ODi4uLh5eVlZFWWVkZGRkWEDAVdJYEl0AVO1C7qugQWozkAMJe+P4AOj/AVFoQfZqgOKABQAAkADd7FJxQAAAABJRU5ErkJggg==" />

  <style>
    /* ========== Base layout & variables ========== */
    :root{
      --bg1: linear-gradient(135deg,#7b3ef9 0%,#ff54a2 100%);
      --bg1-dark: linear-gradient(135deg,#120136 0%,#2a0048 100%);
      --card-bg: rgba(255,255,255,0.12);
      --card-bg-dark: rgba(255,255,255,0.06);
      --accent: #ff54a2;
      --accent-2: #7b3ef9;
      --muted: rgba(255,255,255,0.85);
      --text-dark: #23112b;
      --glass-border: rgba(255,255,255,0.06);
      --shadow: 0 10px 30px rgba(0,0,0,0.28);
      font-family: "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
    }
    html,body{height:100%;margin:0;}
    body{
      min-height:100%;
      margin:0;
      background:var(--bg1);
      color:var(--muted);
      -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
      display:flex;
      flex-direction:column;
      align-items:center;
      padding:18px;
      transition:background 300ms ease,color 250ms ease;
    }
    [data-theme="dark"]{ background:var(--bg1-dark); color:#e9e5f8; }

    /* Header */
    header{
      width:100%;
      max-width:980px;
      text-align:center;
      margin-bottom:18px;
    }
    h1{
      margin:0;
      font-size:2.1rem;
      letter-spacing:0.6px;
      font-weight:800;
      color: white;
      text-shadow: 0 6px 20px rgba(0,0,0,0.28);
    }
    p.lead{margin:6px 0 0;font-weight:500;color:rgba(255,255,255,0.9);}

    /* Top controls */
    .controls{
      width:100%;
      max-width:980px;
      display:flex;
      gap:12px;
      justify-content:space-between;
      align-items:center;
      margin:14px 0 18px;
    }
    .system-select{
      display:flex;
      gap:10px;
      align-items:center;
    }
    select, .btn, .icon-btn {
      border:0; outline:0;
      padding:8px 12px;
      border-radius:10px;
      font-weight:700;
      cursor:pointer;
    }
    select{
      background:rgba(255,255,255,0.9);
      color:var(--text-dark);
      box-shadow:0 4px 18px rgba(0,0,0,0.15);
    }
    .theme-btn{
      background:rgba(255,255,255,0.95);
      display:inline-flex;
      align-items:center;
      gap:8px;
      box-shadow:0 6px 22px rgba(0,0,0,0.18);
      color:var(--text-dark);
    }
    [data-theme="dark"] select{ background:#351245; color:#f3e8ff; box-shadow:0 4px 18px rgba(123,62,249,0.12); }
    [data-theme="dark"] .theme-btn{ background:transparent; color:#f3e8ff; box-shadow:none; border:1px solid rgba(255,255,255,0.05); }

    /* Main grid (cards) */
    main.app{
      width:100%;
      max-width:980px;
      display:grid;
      grid-template-columns: repeat(2, 1fr);
      gap:18px;
    }
    @media (max-width:920px){ main.app{ grid-template-columns: repeat(1,1fr); } }

    .card{
      background:var(--card-bg);
      border-radius:14px;
      padding:16px;
      box-shadow:var(--shadow);
      border:1px solid var(--glass-border);
      transition:transform 200ms ease, box-shadow 200ms ease, background 200ms ease;
    }
    [data-theme="dark"] .card{ background:var(--card-bg-dark); box-shadow:0 16px 40px rgba(0,0,0,0.45); }

    .card legend{ font-weight:800; font-size:1.05rem; color: white; margin-bottom:8px; display:block; }
    .field{ display:flex; flex-direction:column; gap:8px; margin-bottom:10px; }
    .field input[type="text"], .field input[type="date"]{
      padding:10px 12px; border-radius:10px; border:0; font-weight:700;
      background:rgba(255,255,255,0.95); color:var(--text-dark);
    }
    [data-theme="dark"] .field input{ background:#2b004c; color:#f2e9ff; }

    .card .btn{
      margin-top:8px; width:100%;
      background:linear-gradient(90deg,var(--accent-2),var(--accent));
      color:white; font-weight:900;
      box-shadow:0 8px 28px rgba(123,62,249,0.28);
    }
    .card .btn:active{ transform:translateY(1px); }

    /* Results area full width below cards */
    .results-wrap{ grid-column:1 / -1; margin-top:6px; }
    .results {
      background:rgba(255,255,255,0.95);
      color:var(--text-dark);
      border-radius:12px;
      padding:18px;
      min-height:220px;
      font-family: "Courier New", monospace;
      font-size:0.97rem;
      box-shadow: inset 0 3px 10px rgba(0,0,0,0.06);
      white-space:pre-wrap;
      overflow:auto;
    }
    [data-theme="dark"] .results{ background:#2b004c; color:#f3e8ff; box-shadow: inset 0 6px 20px rgba(123,62,249,0.2); }

    footer{
      margin-top:20px; color:rgba(255,255,255,0.85);
      font-size:0.9rem;
      text-align:center;
    }

    /* small helper styles */
    .small { font-size:0.86rem; opacity:0.95; }
    .muted { opacity:0.85; font-weight:600; }
    .row { display:flex; gap:8px; }
    .half { flex:1; }
  </style>
</head>
<body>

  <header>
    <h1>Numeroscope</h1>
    <p class="lead">Ultimate Numerology Calculator — Pythagorean & Chaldean with 100‑word reports</p>
  </header>

  <div class="controls" style="max-width:980px;">
    <div class="system-select">
      <label for="numerologySystem" class="muted small">System</label>
      <select id="numerologySystem" aria-label="Numerology system">
        <option value="p">Pythagorean</option>
        <option value="c">Chaldean</option>
      </select>
    </div>

    <div style="display:flex;gap:10px;align-items:center;">
      <button class="theme-btn" id="themeBtn" title="Toggle theme" aria-pressed="false">
        <svg width="18" height="18" viewBox="0 0 24 24" style="display:block;"><path d="M12 3a9 9 0 1 0 9 9 9 9 0 0 0-9-9z" fill="#6a2dad"></path></svg>
        <span class="small">Theme</span>
      </button>
    </div>
  </div>

  <main class="app" role="main" aria-live="polite" aria-atomic="true">

    <!-- Full Name -->
    <section class="card" aria-labelledby="nameLegend">
      <legend id="nameLegend">Full Name Calculator</legend>
      <div class="field">
        <label class="small">Full Name</label>
        <input id="fullName" type="text" placeholder="e.g. Jane Maria Doe" autocomplete="off">
      </div>
      <div class="field">
        <label class="small">Birthdate (optional)</label>
        <input id="birthDate" type="date">
      </div>
      <button class="btn" id="calcNameBtn">Calculate</button>
    </section>

    <!-- Mobile Number -->
    <section class="card" aria-labelledby="mobileLegend">
      <legend id="mobileLegend">Mobile Number Numerology</legend>
      <div class="field">
        <label class="small">Mobile / Phone Number</label>
        <input id="mobileNumber" type="text" placeholder="Digits & separators accepted">
      </div>
      <button class="btn" id="calcMobileBtn">Analyze</button>
    </section>

    <!-- Angle / Repeating numbers -->
    <section class="card" aria-labelledby="angleLegend">
      <legend id="angleLegend">Angle / Repeating Numbers</legend>
      <div class="field">
        <label class="small">Angle or Repeating Number</label>
        <input id="angleNumber" type="text" placeholder="e.g. 11:11 or 2222">
      </div>
      <button class="btn" id="calcAngleBtn">Analyze</button>
    </section>

    <!-- License Plate -->
    <section class="card" aria-labelledby="licenseLegend">
      <legend id="licenseLegend">License Plate Reading</legend>
      <div class="field">
        <label class="small">License Plate</label>
        <input id="licensePlate" type="text" placeholder="Alphanumeric allowed">
      </div>
      <button class="btn" id="calcLicenseBtn">Read</button>
    </section>

    <!-- Product Serial -->
    <section class="card" aria-labelledby="productLegend">
      <legend id="productLegend">Product Serial Analyzer</legend>
      <div class="field">
        <label class="small">Product Serial / Code</label>
        <input id="productSerial" type="text" placeholder="Serial, SKU, model no.">
      </div>
      <button class="btn" id="calcProductBtn">Analyze</button>
    </section>

    <!-- Name change -->
    <section class="card" aria-labelledby="changeLegend">
      <legend id="changeLegend">Name Change Evaluator</legend>
      <div class="field">
        <label class="small">Original Name</label>
        <input id="originalName" type="text">
      </div>
      <div class="field">
        <label class="small">Test / New Name</label>
        <input id="testName" type="text">
      </div>
      <button class="btn" id="calcNameChangeBtn">Evaluate</button>
    </section>

    <!-- Name vibration -->
    <section class="card" aria-labelledby="vibLegend">
      <legend id="vibLegend">Name Vibration Checker</legend>
      <div class="field">
        <label class="small">Name</label>
        <input id="vibrationName" type="text">
      </div>
      <button class="btn" id="calcVibrationBtn">Check Vibration</button>
    </section>

    <!-- Business name -->
    <section class="card" aria-labelledby="bizLegend">
      <legend id="bizLegend">Business / Product Name Checker</legend>
      <div class="field">
        <label class="small">Business or Product Name</label>
        <input id="businessName" type="text" placeholder="Brand, product or store name">
      </div>
      <button class="btn" id="calcBusinessBtn">Check Name</button>
    </section>

    <!-- Results block full width -->
    <div class="results-wrap card" style="background:transparent; box-shadow:none; border:none;">
      <div style="width:100%;" class="results" id="results" aria-live="polite" aria-atomic="true">Your Numerology Report Analysis will appear here. Each explanation is a thoughtfully written ~100-word analysis tailored to the calculated number.</div>
    </div>

  </main>

  <footer>
    Tip: For best “Add to Home Screen” experience, serve the file via HTTPS or open on localhost. This single-page app includes an inline manifest and tries to register a service worker automatically.
  </footer>

  <!-- ========== SCRIPT: logic, data, manifest & SW registration ========== -->
  <script>
  /**************************************************************************
   * Numeroscope — readable, well-commented script
   * - dual numerology maps (Pythagorean & Chaldean)
   * - calculation helpers
   * - fixed ~100-word descriptions for numbers 1-9, 11,22,33
   * - UI wiring for each module
   * - dynamic manifest creation (with embedded base64 icons)
   * - in-page service worker registration via blob (works on HTTPS/localhost)
   **************************************************************************/

  // ---------- maps ----------
  const pythagoreanMap = {
    a:1,b:2,c:3,d:4,e:5,f:6,g:7,h:8,i:9,
    j:1,k:2,l:3,m:4,n:5,o:6,p:7,q:8,r:9,
    s:1,t:2,u:3,v:4,w:5,x:6,y:7,z:8
  };
  const chaldeanMap = {
    a:1,b:2,c:3,d:4,e:5,f:8,g:3,h:5,i:1,
    j:1,k:2,l:3,m:4,n:5,o:7,p:8,q:1,r:2,
    s:3,t:4,u:6,v:6,w:6,x:5,y:1,z:7
  };

  // ---------- utilities ----------
  function sumDigits(n){
    return String(n).split('').reduce((s,ch)=>s+Number(ch||0),0);
  }
  function reduceToOneDigit(num){
    // preserve masters 11,22,33 if they appear exactly
    if ([11,22,33].includes(num)) return num;
    while(num>9 && ![11,22,33].includes(num)){
      num = sumDigits(num);
    }
    return num;
  }

  function calculateNameValue(str, system){
    // allow alphanumeric (letters map via chosen map; digits add directly)
    const map = system === 'c' ? chaldeanMap : pythagoreanMap;
    if(!str) return null;
    str = String(str).toLowerCase();
    let total = 0;
    for(const ch of str){
      if(/[a-z]/.test(ch)) total += map[ch] || 0;
      else if (/\d/.test(ch)) total += Number(ch);
    }
    return reduceToOneDigit(total);
  }

  // ---------- 100-word (approx) vibrational descriptions ----------
  // Each string contains ~100 words and describes character, strengths, challenges, and advice.
  function vibrationalMeaning(num){
    const texts = {
      1: `Number 1 is the embodiment of leadership, independence, and new beginnings. It represents the pioneering spirit and a deep drive to achieve personal goals. People under this vibration are ambitious, confident, and self-reliant; they prefer to lead and set new standards rather than follow. Their creativity often shows through initiative and original thinking. Challenges include a tendency toward impatience, competitiveness, or stubbornness when others resist. The best approach is to temper ambition with empathy, cultivate patience, and invite collaboration when needed. When balanced, number 1 energy manifests as inspired leadership that motivates others and produces clear, lasting results.`,
    2: `Number 2 vibrates with diplomacy, cooperation, and the art of relationship. Those influenced by number 2 excel at listening, empathizing, and creating environments of peace and mutual support. Their strength lies in intuition and emotional intelligence, making them natural mediators, partners, and team builders. They prefer harmony over conflict and often sacrifice personal spotlight to nurture community ties. Challenges include indecision or a tendency to prioritize others’ needs over their own. Advice: practice healthy boundaries and assertive kindness. With balance, number 2 fosters strong partnerships, reliable teamwork, and gentle influence that quietly transforms tense situations into constructive collaborations.`,
    3: `Number 3 radiates creativity, joyful expression, and sociable charm. People with this vibration often possess natural artistic gifts, excellent communication skills, and an infectious optimism. They shine in roles that allow storytelling, performance, or imaginative problem solving. Their enthusiasm draws others and uplifts teams, but dispersing energy and lack of focus can be pitfalls. They thrive when they structure creative efforts into manageable projects and follow through consistently. Embrace discipline gently, channeling spontaneity into productive outlets. In healthy expression, number 3 brings laughter, inspiration, and contagious positivity that encourages others to create and celebrate life’s possibilities.`,
    4: `Number 4 signifies practicality, dedication, and the art of building durable foundations. Individuals with this vibration are organized, reliable, and deeply committed to tasks that require persistence and attention to detail. They excel at long-term planning, systems thinking, and turning abstract ideas into functional structures. Their steady work ethic yields dependable results, though rigidity and fear of change can present obstacles. Growth involves balancing structure with flexibility and avoiding perfectionism that stalls progress. When balanced, number 4 energy produces resilience, trustworthy competence, and the kind of patient craftsmanship that underpins lasting success and steady advancement in career and personal endeavors.`,
    5: `Number 5 is restless, adventurous, and freedom-loving. This vibration celebrates curiosity, exploration, and a willingness to embrace change. People influenced by number 5 are versatile, quick-thinking, and enjoy variety in life—travel, new experiences, and experimentation energize them. Challenges include impulsivity, inconsistency, or difficulty committing long-term. The remedy is to cultivate mindful freedom: plan for change while maintaining a few stable anchors. Channel restless energy into learning and entrepreneurship where adaptability is an asset. With balance, number 5 leads to a life rich in discovery, personal growth, and the ability to reinvent oneself positively when circumstances shift.`,
    6: `Number 6 centers on care, responsibility, and the nurturing of home and community. Those shaped by this vibration are compassionate, protective, and motivated to create harmony and beauty in relationships and surroundings. They often take on supportive roles—caregiver, teacher, counselor—where steadiness and service matter. Over-giving, perfectionism, or controlling tendencies can arise if boundaries are weak. Learning to receive as well as give is vital. Emphasize self-care while maintaining devotion to others. When balanced, number 6 energy creates loving, stable households and communities where responsibility is shared and compassionate leadership fosters wellbeing for many.`,
    7: `Number 7 embodies introspection, intellectual depth, and spiritual seeking. Individuals with this vibration are analytical, contemplative, and drawn to study, research, and inner exploration. They prize solitude for reflection and often excel in academic, scientific, or metaphysical pursuits. While their insight is profound, they can be perceived as aloof or distant in social settings. Emotional vulnerability and connection may require conscious practice. Developing routines for self-expression alongside study helps integrate inner wisdom into daily life. Balanced number 7 energy yields a thoughtful, wise presence that blends analytical skill with intuitive understanding of life’s deeper patterns.`,
    8: `Number 8 carries authority, ambition, and an ability to manifest material success. People guided by 8 are strategic, business-minded, and effective at organizing resources to achieve large goals. They are natural leaders in commerce, management, and practical problem-solving, often enjoying results from disciplined effort. However, a single-minded focus on achievement can create imbalance, risking burnout or ethical blind spots. Emphasize integrity, generosity, and long-term stewardship. When combined with clear values, number 8 energy empowers meaningful influence: building sustainable enterprises, creating prosperous systems, and guiding others with pragmatic vision and responsible leadership.`,
    9: `Number 9 symbolizes completion, compassion, and global vision. Individuals with this vibration are often altruistic, creative, and motivated by humanitarian ideals. They feel a deep empathy for others and seek to enact change that uplifts broad communities. Artistic talent, leadership in service, and a desire to resolve injustices commonly appear. Challenges include emotional overwhelm or difficulty letting go at endings. Cultivating healthy detachment while channeling compassion into practical action helps. When embodied, number 9 brings wise, soulful leadership that inspires collective healing, fosters generosity, and helps realize projects that benefit many beyond the self.`,
    11: `Master Number 11 represents heightened intuition, inspiration, and a calling toward spiritual insight. People with 11 often experience vivid inner knowing, psychic sensitivity, and a strong yearning to uplift others. This vibration emphasizes visionary creativity, charismatic communication, and a capacity to catalyze meaningful change through subtle influence. Challenges include nervous tension, mood swings, and self-doubt; spiritual practice and grounding techniques are highly supportive. When integrated, Master 11 enables compassionate leadership and awakens collective potentials, allowing an individual to act as a luminous channel—bringing fresh insight, creative solutions, and a deep, intuitive compass to guide important work.`,
    22: `Master Number 22 is the pragmatic visionary: the master builder that turns large dreams into tangible reality. Individuals influenced by 22 combine intuition with stellar organizational skill and the discipline to enact durable projects affecting many. This vibration supports leadership in architecture, institutions, business, or community transformation—areas where scale and reliability matter. The main trials are stress from massive responsibility and the need to balance idealism with pragmatic constraints. Grounding routines, delegation, and ethical alignment are essential. When successfully embodied, 22 energy leaves lasting legacies: structures, systems, and institutions designed to uplift whole communities across generations.`,
    33: `Master Number 33 is the master teacher of compassion, service, and spiritual leadership. Those carrying 33 energy are drawn to heal, teach, and inspire through lived example and tender authority. They combine creativity with profound empathy, often leading charitable or educational work that nurtures others’ growth. Challenges include self-sacrifice to the point of depletion and boundary difficulties. Learning to steward one’s own needs while serving others is crucial. When balanced, 33 radiates radiant teaching: transforming pain into compassion, guiding people toward their better selves, and fostering communities grounded in love, wisdom, and practical healing for many people at once.`
    };
    return texts[num] || "This number carries a complex vibration and may combine many traits. Use this as a starting point for reflection and explore how the qualities resonate in your life.";
  }

  // ---------- UI bindings ----------
  const systemSelect = document.getElementById('numerologySystem');
  const resultsEl = document.getElementById('results');

  // Read values
  const els = {
    name: document.getElementById('fullName'),
    birth: document.getElementById('birthDate'),
    mobile: document.getElementById('mobileNumber'),
    angle: document.getElementById('angleNumber'),
    license: document.getElementById('licensePlate'),
    product: document.getElementById('productSerial'),
    origName: document.getElementById('originalName'),
    testName: document.getElementById('testName'),
    vibName: document.getElementById('vibrationName'),
    biz: document.getElementById('businessName')
  };

  // Buttons
  document.getElementById('calcNameBtn').addEventListener('click', ()=>{
    const system = systemSelect.value;
    const name = els.name.value.trim();
    if(!name){ alert('Please enter a full name.'); els.name.focus(); return; }
    const nameVal = calculateNameValue(name, system);
    const birthVal = els.birth.value ? (function(){ let v=birthdateValue(els.birth.value); return v; })() : null;
    let out = `Full Name Numerology (${system==='c'?'Chaldean':'Pythagorean'}):\n\n`;
    out += `Name Value: ${nameVal}\n\n${vibrationalMeaning(nameVal)}\n\n`;
    if(birthVal!==null) out += `Birthdate Value: ${birthVal}\n\n${vibrationalMeaning(birthVal)}\n\n`;
    resultsEl.textContent = out;
  });

  document.getElementById('calcMobileBtn').addEventListener('click', ()=>{
    const system = systemSelect.value;
    const raw = els.mobile.value.trim();
    if(!raw){ alert('Enter mobile number.'); els.mobile.focus(); return; }
    const num = sumNumbersFromString(raw, system);
    let out = `Mobile Number Numerology (${system==='c'?'Chaldean':'Pythagorean'}):\n\n`;
    out += `Number Value: ${num}\n\n${vibrationalMeaning(num)}\n\n`;
    resultsEl.textContent = out;
  });

  document.getElementById('calcAngleBtn').addEventListener('click', ()=>{
    const system = systemSelect.value;
    const raw = els.angle.value.trim();
    if(!raw){ alert('Enter an angle or repeating number.'); els.angle.focus(); return; }
    const digits = raw.replace(/\D/g,'');
    if(!digits){ alert('No digits found.'); return; }
    // Try to detect master 11/22/33 as whole sequences; otherwise reduce
    let detected = null;
    if (/^(11)+$/.test(digits)) detected = 11;
    else if(/^(22)+$/.test(digits)) detected = 22;
    else if(/^(33)+$/.test(digits)) detected = 33;
    const value = detected || reduceToOneDigit(Number(digits));
    let out = `Angle / Repeating Number Analysis:\n\nNumber Value: ${value}\n\n${vibrationalMeaning(value)}\n\n`;
    resultsEl.textContent = out;
  });

  document.getElementById('calcLicenseBtn').addEventListener('click', ()=>{
    const system = systemSelect.value;
    const raw = els.license.value.trim();
    if(!raw){ alert('Enter license plate.'); els.license.focus(); return; }
    const val = sumNumbersFromString(raw, system);
    let out = `License Plate Reading (${system==='c'?'Chaldean':'Pythagorean'}):\n\nNumber Value: ${val}\n\n${vibrationalMeaning(val)}\n\n`;
    resultsEl.textContent = out;
  });

  document.getElementById('calcProductBtn').addEventListener('click', ()=>{
    const system = systemSelect.value;
    const raw = els.product.value.trim();
    if(!raw){ alert('Enter product serial.'); els.product.focus(); return; }
    const val = sumNumbersFromString(raw, system);
    let out = `Product Serial Number Analysis (${system==='c'?'Chaldean':'Pythagorean'}):\n\nNumber Value: ${val}\n\n${vibrationalMeaning(val)}\n\n`;
    resultsEl.textContent = out;
  });

  document.getElementById('calcNameChangeBtn').addEventListener('click', ()=>{
    const system = systemSelect.value;
    const o = els.origName.value.trim(), t = els.testName.value.trim();
    if(!o || !t){ alert('Enter both original and test names.'); return; }
    const orig = calculateNameValue(o, system), test = calculateNameValue(t, system);
    let out = `Name Change Evaluation (${system==='c'?'Chaldean':'Pythagorean'}):\n\n`;
    out += `Original (${o}) Value: ${orig}\n\n${vibrationalMeaning(orig)}\n\n`;
    out += `New (${t}) Value: ${test}\n\n${vibrationalMeaning(test)}\n\n`;
    out += (orig===test) ? "The vibration remains the same — the change may feel harmonious with your current energy." : "The vibration differs — expect a shift which could affect personality emphasis and life patterns.";
    resultsEl.textContent = out;
  });

  document.getElementById('calcVibrationBtn').addEventListener('click', ()=>{
    const system = systemSelect.value; const n = els.vibName.value.trim(); if(!n){ alert('Enter a name.'); return; }
    const val = calculateNameValue(n, system);
    let out = `Name Vibration Check (${system==='c'?'Chaldean':'Pythagorean'}):\n\nVibration Number: ${val}\n\n${vibrationalMeaning(val)}\n\n`;
    resultsEl.textContent = out;
  });

  document.getElementById('calcBusinessBtn').addEventListener('click', ()=>{
    const system = systemSelect.value; const n = els.biz.value.trim(); if(!n){ alert('Enter business/product name.'); return; }
    const val = calculateNameValue(n, system);
    let out = `Business/Product Name Check (${system==='c'?'Chaldean':'Pythagorean'}):\n\nName Value: ${val}\n\n${vibrationalMeaning(val)}\n\n`;
    resultsEl.textContent = out;
  });

  // ---------- helper: birthdate & string sums ----------
  function birthdateValue(datestr){
    // YYYY-MM-DD -> sum digits
    const parts = datestr.split('-');
    if(parts.length!==3) return null;
    let total = 0;
    parts.forEach(p => total += sumDigits(p));
    return reduceToOneDigit(total);
  }
  function sumNumbersFromString(str, system){
    const map = system === 'c' ? chaldeanMap : pythagoreanMap;
    str = String(str || '').toLowerCase();
    let total = 0;
    for(const ch of str){
      if(/[a-z]/.test(ch)) total += map[ch] || 0;
      else if(/\d/.test(ch)) total += Number(ch);
    }
    return reduceToOneDigit(total);
  }

  // ---------- THEME handling ----------
  const themeBtn = document.getElementById('themeBtn');
  (function initTheme(){
    const saved = localStorage.getItem('numeroscope-theme');
    if(saved === 'dark'){
      document.documentElement.setAttribute('data-theme','dark');
      themeBtn.setAttribute('aria-pressed','true');
    } else {
      document.documentElement.removeAttribute('data-theme');
      themeBtn.setAttribute('aria-pressed','false');
    }
  })();
  themeBtn.addEventListener('click', ()=>{
    if(document.documentElement.getAttribute('data-theme') === 'dark'){
      document.documentElement.removeAttribute('data-theme');
      localStorage.setItem('numeroscope-theme','light');
      themeBtn.setAttribute('aria-pressed','false');
    } else {
      document.documentElement.setAttribute('data-theme','dark');
      localStorage.setItem('numeroscope-theme','dark');
      themeBtn.setAttribute('aria-pressed','true');
    }
  });

  // ---------- PWA manifest creation using base64 icons (inline) ----------
  // Example small icons (simple purple circle). Replace with your real base64 icons if desired.
  const icon192 = "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMAAAADACAMAAABaW0lVAAAAVFBMVEX///////9FRUXo6OiUlJTZ2dnX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19eSE9tAAAAHklEQVR4nO3BMQEAAADCIPunNscwAAAAAAAAAAAAAODc4AABp4l2FAAAAdklEQVQY02NgGAWjYBSM7GBAg0xmQxQ0YkzYAAwMDAwMjAwMDAz8DAwMDAwMDIDQwMDAwMDAwMDAwMDAwMDAwMDAwMAwMAQGgABeU0K1xQAAAABJRU5ErkJggg==";
  const icon512 = "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIACAIAAAB7GkOtAAAAA3NCSVQICAjb4U/gAAABG0lEQVR4nO3BMQEAAADCoPVPbQ0PoAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4EcG2AABrXf8TAAAAAElFTkSuQmCC";

  // Create manifest object
  const manifestObj = {
    name: "Numeroscope — Ultimate Numerology Calculator",
    short_name: "Numeroscope",
    start_url: ".",
    display: "standalone",
    background_color: "#5b3e96",
    theme_color: "#5b3e96",
    icons:[
      { src: icon192, sizes: "192x192", type: "image/png" },
      { src: icon512, sizes: "512x512", type: "image/png" }
    ]
  };

  // Attach manifest blob as link so Add to Home Screen sees it
  (function attachManifest(){
    try{
      const manifestStr = JSON.stringify(manifestObj);
      const blob = new Blob([manifestStr], { type: 'application/json' });
      const url = URL.createObjectURL(blob);
      const link = document.createElement('link');
      link.rel='manifest';
      link.href = url;
      document.head.appendChild(link);
    }catch(e){
      console.warn('Could not attach manifest inline:', e);
    }
  })();

  // ---------- Service Worker registration using a blob URL ----------
  // The SW caches the page and allows "offline" serving when possible. SW registration requires HTTPS or localhost.
  (function registerSW(){
    if(!('serviceWorker' in navigator)) return;
    // Simple SW script — caches single HTML resource on install and serves it from cache on fetch.
    const swCode = `
      const CACHE = 'numeroscope-v1';
      const URLS = ['./'];
      self.addEventListener('install', event => {
        event.waitUntil(
          caches.open(CACHE).then(c=>c.addAll(URLS)).catch(()=>{})
        );
        self.skipWaiting();
      });
      self.addEventListener('activate', event => {
        event.waitUntil(self.clients.claim());
      });
      self.addEventListener('fetch', event => {
        event.respondWith(
          caches.match(event.request).then(resp => resp || fetch(event.request).catch(()=>caches.match('./')))
        );
      });
    `;
    const blob = new Blob([swCode], { type: 'application/javascript' });
    const swUrl = URL.createObjectURL(blob);
    navigator.serviceWorker.register(swUrl).then(reg=>{
      console.log('ServiceWorker registered (blob):', reg.scope);
    }).catch(err=>{
      console.warn('ServiceWorker registration failed:', err);
    });
  })();

  // ---------- End of script ----------
  </script>
</body>
</html>
